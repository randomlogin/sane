package prove

import (
	"encoding/hex"
	"log"
	"testing"

	"github.com/randomlogin/sane/sync"
)

var rawstr = "0195d34cd1b1649009588025f28aaa1e2aeeaa97f837427ac983e3323e53c9593619c018000000019a9a0e36f93c06e9a04c4115c9a1d347834a8e432bab25891b4283ce6e965d80878c302cc65f0895a0df1d59294382b7e447ef56d9f4c6b8cfc707aefc432131d74b8ae3d03882e08ab453a2ebc9d40c4b7263d5ffe130e527b867c50c34367e51ed3aa00d23b7c9b9f08ce1da1b4253c3a58d954231d5edb6c68b02dc9e0630575174d6a70ab293adfd5e7163bbcb14fabdff5925b7383cb6a5afd76bcc9709c4b073d5f277a75285a15f11c96965ff6502f7f0e7401717d53f3127d49d48b5c31db579a5e7092ae4348a606e4c2d817dc38d46a35d84ed6492337b35d060e444511754712fe7c5de32c13a767d4425989c927d93ec31f8af0aaa217e52b8a28dee5c0dc212bb5196475af00ac5e6589d469a581cce6eded3e83ae33f82fd52d78e1d4c993542a51ad268bb59f819c46d0c39a5d7af48b75421f7277134bb84d702e1dcda9673b52cfec843a2a3b80132691840bbf3117478207fca1ed83a4b8fcfe6fd168bcadbd229ac4c8ef75219e9e771e71f9897dac3f4ba79485c6a1ac564fc6468467559984d79dc71d61790221530ba1b66457d7dac20936852985150cd98e6135dac528fca1145343b1cb083906012eebb7063538f7259ad8e0347290991ae734be1800db6f4b6229b573a44c8fd71626823b52bf84689dbef8c1aed213af7ffef7c2c47b88b8193d804d4811760b8095eb5d11e1ec20ba1a91d06c3e9765d37918ec4a566b465ed18f7f25ce9cb81ebf571a52c09386f511a2ea9718460c28ddb5d8613afeebab64bdc69246ec2d2dc2095752a9a0fb0b1acaead14bc1f431fc6a19c2dd972e1b7e476a7c7b3163900d1ab1abf047bb6968ed9084b25b3448fe24207586b6779df758e2039297a2a04b0586fc0ef24893b925585a440f0196b53205da1078ad4ce5a4dfde61bcc72b0b36be3b41b49e64c32265782ae348e9dd87d0fa9c892443c9c7879d2292dc977d804953b341cd2481f80108e4789c6c8a7ce3b94e27ca10314872dbdc95089dcca74910059e40bab62222201007f45e50abf99d412b1df8e2271329ce203a19d83170565f1f42c00ee29c213a87000086c617a7964616e6534000001036e73310668746f6f6c730000d7f90d02208967ab9cc57d7aeab5ab691b657558c5185cee9e58ba6e091c4a3bf325ecaecd748601008cf70200c5002ce21784a8d6b375731f1784b06426670cdb54331ce19b21ce3d2ce348e9c7d30ffe90230b0001"

var mystr = "01bb0000045f343433045f746370086c65747364616e6500003400010000012c002303010151a908c93287b3ea15bf58ca2c0ba36058fa20e33b9beb8068433b986ea4843b045f343433045f746370086c65747364616e6500002e00010000012c005c00340f0300000e1065d0ef3b65c6390b6a4e086c65747364616e6500a99950bd049644366a65a4d3b3ce4796645a213a59efbf6f278ad5e80738fa10bd6bae852855689f4d601d9d198c34d38c6dd148982536b4c120066eeff2d009086c65747364616e65000030000100000e1000240100030fb074b324f69267f2b31beb40af12c84c9c5982fd5bab055c500ebf92bfa13ec3086c65747364616e65000030000100000e1000240101030f15e0c3fba138e0b018a3cb09b69cdf6f22ce90230a78fc40ac810ad0ec6436a9086c65747364616e6500002e000100000e10005c00300f0100000e1065d0c53e65c60f0e6d99086c65747364616e65003b312e52d44ae5d73c72962aff15fbcc23950a27e358474d6c3b4c3f963b4ccd6dd6508eec3c51aefed86909d56981589a5c67038bc049dfaf1fa566f9e29a09086c65747364616e6500002b00010000545f00246d990f02bff60097255a21e8054eb53d74481b4aa6e51c1b85f8bce97a6cf5aec91ecbb0086c65747364616e6500002e000100002a2f0053002b0d010000546067a796c465c511c4ee1000c19e5ce38040b95e01b141f94126c62917fe0c783492df00640b3b922abd3ad75377676874a9aa01916bffd7112f348ed3508c3c0028c8efff25c21e2a4b58fb00003000010000245600440100030d2399cfb3a72515ad609f09fd22954319d24b7c438dce00f535c7ee13010856e2281dd64682f55b96c2cd6d13beb295b79d060783ddacbe1cb51ce8d3885048b100003000010000245600440101030d4fd714449d8cfcccfdaba52c64d63e3aca72be3f94bfeb60aeb5a42ed3d0c2053f5eee58934974d929f9b9adb10107c4608cd13babf9880f817a331e13034fe100002e000100002456005300300d0000002a3067a790eb65c50beb898f003df9b8936b1f12e0550904a5ed06bfbeedaf053ab5cbb1bea1d470568362e03538631b31001615053ae82e39c70658be4f5b2bdd59ea5108ac2636a51d285556"

var lazydane_raw = "01135065889f882c80d319ff65550d4804abb7567d0b1986be197d22993ef03d5b19c018000000010b6dd0b4e57c8e073cbe94faf0b31bf125cda0e167d956895cdd19ced3cb2f011bad17b4ed1497b54b8f95314dd6675a4a79ba5514a00191034024fd8d59e2dc3992d182ba4caa1f77b7fa28b2f44c521347344bd661aa7f98ab2c50667a7483bebe4927f43e508e9c129c036344b6580f86d39d4180b07e23eba6455d1402151e8ff72c9a81ae94cf64ea2fc6325373d95ce02b4d67d302ca32a62c54842bdf1fb4a85fb657a3547ddbd5c6a6ca2c4b1f359cfdcdc07cb47aba955cfce9a90c5c46dcb6f2fcf14d8e80c55c0e4292e4fe83cb2d130c0e95de716c664f4b2e0d0a1dd11aeb1c92a9fecdaf51732610d6abf84e2e7372d9bd58bf70e96c72a2ab708fcc01767ec55a55ae65cd0fdef3ad36f3144970e490399b42b0802fdb2e7ce0bb100586f753795b04ef38c1e591b8699bd6dfb9b13c635c45f1a343ae08a9d710ed29c56185ff059154c7b93e601eef316b1f0eaf651099f34fd966d5478ff2868e679f58d2dabbde65a62f05036a62c5be22f58172a3e970710e862bc8e452a915862ec623eec82595001cb1b1e8628a5c178285d0f7239805398fb51b6950cd98e6135dac528fca1145343b1cb083906012eebb7063538f7259ad8e0347290991ae734be1800db6f4b6229b573a44c8fd71626823b52bf84689dbef8c1aed213af7ffef7c2c47b88b8193d804d4811760b8095eb5d11e1ec20ba1a91d06c3e9765d37918ec4a566b465ed18f7f25ce9cb81ebf571a52c09386f511a2ea9718460c28ddb5d8613afeebab64bdc69246ec2d2dc2095752a9a0fb0b1acaead14bc1f431fc6a19c2dd972e1b7e476a7c7b3163900d1ab1abf047bb6968ed9084b25b3448fe24207586b6779df758e2039297a2a04b0586fc0ef24893b925585a440f0196b53205da1078ad4ce5a4dfde61bcc72b0b36be3b41b49e64c32265782ae348e9dd87d0fa9c892443c9c7879d2292dc977d804953b341cd2481f80108e4789c6c8a7ce3b94e27ca10314872dbdc95089dcca74910059e40bab62222201007f45e50abf99d412b1df8e2271329ce203a19d83170565f1f42c00ee29c213a87000086c617a7964616e6534000001036e73310668746f6f6c730000d7f90d02208967ab9cc57d7aeab5ab691b657558c5185cee9e58ba6e091c4a3bf325ecaecd748601008cf70200c5002ce21784a8d6b375731f1784b06426670cdb54331ce19b21ce3d2ce348e9c7d30ffe90230b0001"

var paranoidPnaguionBoth = "02135065889f882c80d319ff65550d4804abb7567d0b1986be197d22993ef03d5b18c018000000002a7001c6b110fde6e1c9dad309ecc78a206548bc2f16acc27025d6509d74c9cce33eece9d9f50469f6e45b00a2bd6cae485466a17eacbe119a20e4514a5a275534ba38f466c9284a720964e7538db36ef13edab929f89447b59b5f7b184c642d1c8619fc4de09adef0a34d88e8fce61c5233aea11a98d3dcdf3fdabb4c9b037d25e3ae2c3bf6c10e41395eca78446f6b557bbcad39a920218f3d3c59087c5d6e3944ce6225ce09f5f7998bf9ed42246d48b2a41c5f70df5b43d185b23aeeeef3e628678d88e58deca69d3af662e876a1aa55ea01da48719041574254f85ac445eeca474c8450eb06cf1a86b583633af814109ef8b63365011eb714b05fb3904c505fddbf19cdb7b84a731ea850252f61bcabe9e2e8f8adca3cf2a0493ad2cc01761f79ab9e016b28c2e0d37950126f043a34f064057c8580d09de2ca4a4d92fe44ce02f59a426abb341ef40e924feefa22f5351e7778a3138475e2c0e26032db124b6da29b2ce2520411921a997befaf68523885bf080f979524ea32a3dc0ebabc06e7cdeb284ffccd3d0e2270b8ab7a9dd2177556278aa6b3b4511bc65aae4c57ccbdee2b0deea7e32a2c2e55717ddb45ed03994231aea86e936507fd7b6e4a20cc0437124039e9daa0940b59554f911b28179f4c03c6be42f059892e366cd7762570bdb8dd69ada3e9dcecb791d3d2878f6806315d12eb389b590b52e83b033096ef3ba0a9f20740f0af79782d11dec4482c4ef6e97ffb37db8d0b85f258ac6224c1e9e8a6c3f8887f03ace0c745f66853ab879e89b293bac87439a3f97343574d19a09f3a4bd02a6fe207aec389eabbefa3948ba3e118d869ab1a42ef52048d7de7bac55524d2306fab6234ef3b86aa0fb6f9c4c08a1129ecd3bfaa16ac662b771bebfa3010a6ffc9acce9e144e9aaa10af8dded0ba868c442a9c7794c1518a89c99a7a0580b7fce4bb5e97fbc4a9eb531b7f6b105fbc738d30552e5625efadc6ead9b6f10646d8e783b91ba3085580c36c8766f46873f8a84a357a99bbd120818d5dc4d6b1f27cee37fc549f7c82cdbe46c91e7afd33335657fc21b1a18c5f000f706172616e6f696470656e6775696e1e000002036e73310f706172616e6f696470656e6775696e002ce706b701c002c1f6000006800200c5004a503beb48e6161f73629b798f2a9707f70f6a06dd392ee57d461c6b4d15591b0bfd102701dbb86ce07af0665564e6623e03f5dd1fcb8302b25ace673744d2507a301538e818c018000000009b8252a542ddad2771b1e7edf7d4e8dbfdbbb6ba052c85343d59363c95e21265e180a5c5f18928e0c7aa819f73f49c7dc1fbb79ed5f2efd3d9da27a18262fac4f9eea8bb39ed6bdb5c124e6b3e6ef0a2bc88bb4dcbeabc160888bfb2256de00bb7341b75c94fac1dd058529d89eb2e46963f77c76890f14f3a0a18f5db1e913003642c632579a99debbd09f34bfe93c8444e993c5245ebb727c3bd6b46c0c7a87c4315e9cd817a0169c90e29574a6c00b083675677aa85633273df6a5ffe1be94e446115f38735da226a099def52845d8bcb21fbcb846b6cf9f88c5891cf3ef92577d9673366a463db462b964d8b75c6ab3c2f1f9ae110f9025a71fee6c74f9a8e03a8693b4ab6a8128ad54874f2ad03c42dad8e1a6b34f716a71dc17e41d7e85faaf80a6da902916190526af7b6b0008930e966d60f5586d0c3cbb550dcf6b29a65ca61f21b2a8f6583332cf27a274ec4da6e62dfaa70085216b7b80ec099970fc32651e4466b02dafb0f85af3f2d074961d35e9e00392139cc250536dce920e53c4a6794279f07848179a57e0ef75c662b9299c48ffb383342290c9b96ea1a14098e00500cb00564e598be29fd82d0ddc6a1ce21af272e6588dc04222f3f2cbd3538e7c3cce4d629d577bcc45277a0f573e52fd910d3b17e0e4db503e141db8c075ee507fa60c03d9539c794614cf002fa2ec6bdc1d57fed2213af16f545ab3096ef3ba0a9f20740f0af79782d11dec4482c4ef6e97ffb37db8d0b85f258ac66d6dc76cae6738f09f5ba4c8056528ba18011be5fa930f8a0981e069ab36106574d19a09f3a4bd02a6fe207aec389eabbefa3948ba3e118d869ab1a42ef5204e9b729529d7e05c288450d449999ef076808970a4c18d771ecdd07b14221d1852b771bebfa3010a6ffc9acce9e144e9aaa10af8dded0ba868c442a9c7794c1518a89c99a7a0580b7fce4bb5e97fbc4a9eb531b7f6b105fbc738d30552e5625efadc6ead9b6f10646d8e783b91ba3085580c36c8766f46873f8a84a357a99bbd120818d5dc4d6b1f27cee37fc549f7c82cdbe46c91e7afd33335657fc21b1a18cd5000f706172616e6f696470656e6775696e94000002036e73310f706172616e6f696470656e6775696e002ce706b701c00200eb560d0114407895fb4aa1539892f4b45c4e70e9aa91359a7700eb560d02206f6bc8db57e7aefea61bd365ac14f3061045770a5338fb16c3c4fab2c9b84f3900eb560d04300632089854c434edbd9b70a5434b30fa6bc44ec90e783e573921d330c30bfff41f9d9c01b347a031a2a752f866b43b7fc1f6000006800200c500243443f6d87365d867cd247150628aaf9a39df4bb6e6bfef34022f25b6ab678400fd102701"

var peng2 = "dbb86ce07af0665564e6623e03f5dd1fcb8302b25ace673744d2507a301538e818c018000000009b8252a542ddad2771b1e7edf7d4e8dbfdbbb6ba052c85343d59363c95e21265e180a5c5f18928e0c7aa819f73f49c7dc1fbb79ed5f2efd3d9da27a18262fac4f9eea8bb39ed6bdb5c124e6b3e6ef0a2bc88bb4dcbeabc160888bfb2256de00bb7341b75c94fac1dd058529d89eb2e46963f77c76890f14f3a0a18f5db1e913003642c632579a99debbd09f34bfe93c8444e993c5245ebb727c3bd6b46c0c7a87c4315e9cd817a0169c90e29574a6c00b083675677aa85633273df6a5ffe1be94e446115f38735da226a099def52845d8bcb21fbcb846b6cf9f88c5891cf3ef92577d9673366a463db462b964d8b75c6ab3c2f1f9ae110f9025a71fee6c74f9a8e03a8693b4ab6a8128ad54874f2ad03c42dad8e1a6b34f716a71dc17e41d7e85faaf80a6da902916190526af7b6b0008930e966d60f5586d0c3cbb550dcf6b29a65ca61f21b2a8f6583332cf27a274ec4da6e62dfaa70085216b7b80ec099970fc32651e4466b02dafb0f85af3f2d074961d35e9e00392139cc250536dce920e53c4a6794279f07848179a57e0ef75c662b9299c48ffb383342290c9b96ea1a14098e00500cb00564e598be29fd82d0ddc6a1ce21af272e6588dc04222f3f2cbd3538e7c3cce4d629d577bcc45277a0f573e52fd910d3b17e0e4db503e141db8c075ee507fa60c03d9539c794614cf002fa2ec6bdc1d57fed2213af16f545ab3096ef3ba0a9f20740f0af79782d11dec4482c4ef6e97ffb37db8d0b85f258ac66d6dc76cae6738f09f5ba4c8056528ba18011be5fa930f8a0981e069ab36106574d19a09f3a4bd02a6fe207aec389eabbefa3948ba3e118d869ab1a42ef5204e9b729529d7e05c288450d449999ef076808970a4c18d771ecdd07b14221d1852b771bebfa3010a6ffc9acce9e144e9aaa10af8dded0ba868c442a9c7794c1518a89c99a7a0580b7fce4bb5e97fbc4a9eb531b7f6b105fbc738d30552e5625efadc6ead9b6f10646d8e783b91ba3085580c36c8766f46873f8a84a357a99bbd120818d5dc4d6b1f27cee37fc549f7c82cdbe46c91e7afd33335657fc21b1a18cd5000f706172616e6f696470656e6775696e94000002036e73310f706172616e6f696470656e6775696e002ce706b701c00200eb560d0114407895fb4aa1539892f4b45c4e70e9aa91359a7700eb560d02206f6bc8db57e7aefea61bd365ac14f3061045770a5338fb16c3c4fab2c9b84f3900eb560d04300632089854c434edbd9b70a5434b30fa6bc44ec90e783e573921d330c30bfff41f9d9c01b347a031a2a752f866b43b7fc1f6000006800200c500243443f6d87365d867cd247150628aaf9a39df4bb6e6bfef34022f25b6ab678400fd102701"

var sane = "01b7962c4d8d015f20f891b7669dbae1edc4ef8f97086f1bf24cd76d7f38a6fca219c0190000000000ce64d3c071c69b741b523ee03098134fc3642b53ddca25374190343fcd9a5ed20663d982766166d88ce1447282533127c699eab28b35351f9b4edd6ed2f924d26540f62d0c960e86a1dc843b20fe5386813483d95a8853f2d5c8e4a001fe1fe82137a91946287653a2e4d89c601ef6f2992b975e784250f54ae8a1787442a13567fe5644cb49d6f2546342a308ab0d23fdbd08db2cf83d23b515c306bb812ab210779ded11c44c4845e666e05253c5371688ab175a3a9473a0a0401d6ccabf09cc7b0d457b6cf1f67745f3c45443868e22347d3f4b22846341a67be48552ed330443340dc8dd9f2bde5dc7b63d09cfe00620b4915391345b106f43644cb360192d6ca10c422e1a05a113e6e3f5d37dc76022929c65be58bcb362730e1a10433ef18da24fde090439cb74b7bae63f55eed1bfa01b41bb93475491bddbb84e0f4ee68dbbf58a77c24fa8c69fe79c6b2fa56dd89d82cc19bdbad61d55fef1b16d607bbef30e386f66f6e6463b5790abdec2ae62223a92fb6502fdaedd32a6f5dd52b4ef6fc6ae111d24f4451b7736cad2f953b2a6c5f47ae2067b169d10ce8086621f36cb6beacb41ff80cb1742b14f7a713b7b7e98a50edd13d507d09be3176265c1436b3c991c268ccb6d44343588262a9d253696b1f094e89653633dcdee9c0eb6ef857815e01d9060d21420cfaf7c3ea10cb6b78113917c956b5ebc2845122cd6cbf5f18b71683dfcc517995f544e6f68d26bda32c67130ba4eb486be60a1f58e3067f0e66296d628f2d03220510901f59c912920490a0e5358444303b8546d86129ebaf6d0b27877f2072fe17c50412c459bd58ae28bf4dc64dd0ca52e662af265559d84572a1975ce73cd40d85ee93ca37d9bb8a1a9fef3907919766879a8c2914f94cd71a26794110ad994605d4134ae91c02f9ff50edb8316f43f87f73a7ba4570241431307a3428386978bcc2f41a60d0a88245cf4e524d4d9ebf85d4e75c9d6b08ea37cb3f44778d54f074fffba694de176a0c41d2540d4e049c6499f11444b4abfab5d4bc217afd35ff623ab49d3fffd857b08367eb6dd7e4a8aa5635c16b31103afd193ea1a57b279df99cd0db16e57a0bb94eea236f393f41d2d1150000473616e6513000002036e73310473616e65002ce706b701c002b548000064210300c70052a00f45085c1afb8448e6dff1d27af7be9ce43a68f33389d45451d717bd6fc801fe80e9eb1dfe002f685902"

var lazy_sane = "02135065889f882c80d319ff65550d4804abb7567d0b1986be197d22993ef03d5b19c018000000010b6dd0b4e57c8e073cbe94faf0b31bf125cda0e167d956895cdd19ced3cb2f011bad17b4ed1497b54b8f95314dd6675a4a79ba5514a00191034024fd8d59e2dc3992d182ba4caa1f77b7fa28b2f44c521347344bd661aa7f98ab2c50667a7483bebe4927f43e508e9c129c036344b6580f86d39d4180b07e23eba6455d1402151e8ff72c9a81ae94cf64ea2fc6325373d95ce02b4d67d302ca32a62c54842bdf1fb4a85fb657a3547ddbd5c6a6ca2c4b1f359cfdcdc07cb47aba955cfce9a90c5c46dcb6f2fcf14d8e80c55c0e4292e4fe83cb2d130c0e95de716c664f4b2e0d0a1dd11aeb1c92a9fecdaf51732610d6abf84e2e7372d9bd58bf70e96c72a2ab708fcc01767ec55a55ae65cd0fdef3ad36f3144970e490399b42b0802fdb2e7ce0bb100586f753795b04ef38c1e591b8699bd6dfb9b13c635c45f1a343ae08a9d710ed29c56185ff059154c7b93e601eef316b1f0eaf651099f34fd966d5478ff2868e679f58d2dabbde65a62f05036a62c5be22f58172a3e970710e862bc8e452a915862ec623eec82595001cb1b1e8628a5c178285d0f7239805398fb51b6950cd98e6135dac528fca1145343b1cb083906012eebb7063538f7259ad8e0347290991ae734be1800db6f4b6229b573a44c8fd71626823b52bf84689dbef8c1aed213af7ffef7c2c47b88b8193d804d4811760b8095eb5d11e1ec20ba1a91d06c3e9765d37918ec4a566b465ed18f7f25ce9cb81ebf571a52c09386f511a2ea9718460c28ddb5d8613afeebab64bdc69246ec2d2dc2095752a9a0fb0b1acaead14bc1f431fc6a19c2dd972e1b7e476a7c7b3163900d1ab1abf047bb6968ed9084b25b3448fe24207586b6779df758e2039297a2a04b0586fc0ef24893b925585a440f0196b53205da1078ad4ce5a4dfde61bcc72b0b36be3b41b49e64c32265782ae348e9dd87d0fa9c892443c9c7879d2292dc977d804953b341cd2481f80108e4789c6c8a7ce3b94e27ca10314872dbdc95089dcca74910059e40bab62222201007f45e50abf99d412b1df8e2271329ce203a19d83170565f1f42c00ee29c213a87000086c617a7964616e6534000001036e73310668746f6f6c730000d7f90d02208967ab9cc57d7aeab5ab691b657558c5185cee9e58ba6e091c4a3bf325ecaecd748601008cf70200c5002ce21784a8d6b375731f1784b06426670cdb54331ce19b21ce3d2ce348e9c7d30ffe90230b0001b7962c4d8d015f20f891b7669dbae1edc4ef8f97086f1bf24cd76d7f38a6fca219c0190000000000ce64d3c071c69b741b523ee03098134fc3642b53ddca25374190343fcd9a5ed20663d982766166d88ce1447282533127c699eab28b35351f9b4edd6ed2f924d26540f62d0c960e86a1dc843b20fe5386813483d95a8853f2d5c8e4a001fe1fe82137a91946287653a2e4d89c601ef6f2992b975e784250f54ae8a1787442a13567fe5644cb49d6f2546342a308ab0d23fdbd08db2cf83d23b515c306bb812ab210779ded11c44c4845e666e05253c5371688ab175a3a9473a0a0401d6ccabf09cc7b0d457b6cf1f67745f3c45443868e22347d3f4b22846341a67be48552ed330443340dc8dd9f2bde5dc7b63d09cfe00620b4915391345b106f43644cb360192d6ca10c422e1a05a113e6e3f5d37dc76022929c65be58bcb362730e1a10433ef18da24fde090439cb74b7bae63f55eed1bfa01b41bb93475491bddbb84e0f4ee68dbbf58a77c24fa8c69fe79c6b2fa56dd89d82cc19bdbad61d55fef1b16d607bbef30e386f66f6e6463b5790abdec2ae62223a92fb6502fdaedd32a6f5dd52b4ef6fc6ae111d24f4451b7736cad2f953b2a6c5f47ae2067b169d10ce8086621f36cb6beacb41ff80cb1742b14f7a713b7b7e98a50edd13d507d09be3176265c1436b3c991c268ccb6d44343588262a9d253696b1f094e89653633dcdee9c0eb6ef857815e01d9060d21420cfaf7c3ea10cb6b78113917c956b5ebc2845122cd6cbf5f18b71683dfcc517995f544e6f68d26bda32c67130ba4eb486be60a1f58e3067f0e66296d628f2d03220510901f59c912920490a0e5358444303b8546d86129ebaf6d0b27877f2072fe17c50412c459bd58ae28bf4dc64dd0ca52e662af265559d84572a1975ce73cd40d85ee93ca37d9bb8a1a9fef3907919766879a8c2914f94cd71a26794110ad994605d4134ae91c02f9ff50edb8316f43f87f73a7ba4570241431307a3428386978bcc2f41a60d0a88245cf4e524d4d9ebf85d4e75c9d6b08ea37cb3f44778d54f074fffba694de176a0c41d2540d4e049c6499f11444b4abfab5d4bc217afd35ff623ab49d3fffd857b08367eb6dd7e4a8aa5635c16b31103afd193ea1a57b279df99cd0db16e57a0bb94eea236f393f41d2d1150000473616e6513000002036e73310473616e65002ce706b701c002b548000064210300c70052a00f45085c1afb8448e6dff1d27af7be9ce43a68f33389d45451d717bd6fc801fe80e9eb1dfe002f685902"

var sane_lazy = "02b7962c4d8d015f20f891b7669dbae1edc4ef8f97086f1bf24cd76d7f38a6fca219c0190000000000ce64d3c071c69b741b523ee03098134fc3642b53ddca25374190343fcd9a5ed20663d982766166d88ce1447282533127c699eab28b35351f9b4edd6ed2f924d26540f62d0c960e86a1dc843b20fe5386813483d95a8853f2d5c8e4a001fe1fe82137a91946287653a2e4d89c601ef6f2992b975e784250f54ae8a1787442a13567fe5644cb49d6f2546342a308ab0d23fdbd08db2cf83d23b515c306bb812ab210779ded11c44c4845e666e05253c5371688ab175a3a9473a0a0401d6ccabf09cc7b0d457b6cf1f67745f3c45443868e22347d3f4b22846341a67be48552ed330443340dc8dd9f2bde5dc7b63d09cfe00620b4915391345b106f43644cb360192d6ca10c422e1a05a113e6e3f5d37dc76022929c65be58bcb362730e1a10433ef18da24fde090439cb74b7bae63f55eed1bfa01b41bb93475491bddbb84e0f4ee68dbbf58a77c24fa8c69fe79c6b2fa56dd89d82cc19bdbad61d55fef1b16d607bbef30e386f66f6e6463b5790abdec2ae62223a92fb6502fdaedd32a6f5dd52b4ef6fc6ae111d24f4451b7736cad2f953b2a6c5f47ae2067b169d10ce8086621f36cb6beacb41ff80cb1742b14f7a713b7b7e98a50edd13d507d09be3176265c1436b3c991c268ccb6d44343588262a9d253696b1f094e89653633dcdee9c0eb6ef857815e01d9060d21420cfaf7c3ea10cb6b78113917c956b5ebc2845122cd6cbf5f18b71683dfcc517995f544e6f68d26bda32c67130ba4eb486be60a1f58e3067f0e66296d628f2d03220510901f59c912920490a0e5358444303b8546d86129ebaf6d0b27877f2072fe17c50412c459bd58ae28bf4dc64dd0ca52e662af265559d84572a1975ce73cd40d85ee93ca37d9bb8a1a9fef3907919766879a8c2914f94cd71a26794110ad994605d4134ae91c02f9ff50edb8316f43f87f73a7ba4570241431307a3428386978bcc2f41a60d0a88245cf4e524d4d9ebf85d4e75c9d6b08ea37cb3f44778d54f074fffba694de176a0c41d2540d4e049c6499f11444b4abfab5d4bc217afd35ff623ab49d3fffd857b08367eb6dd7e4a8aa5635c16b31103afd193ea1a57b279df99cd0db16e57a0bb94eea236f393f41d2d1150000473616e6513000002036e73310473616e65002ce706b701c002b548000064210300c70052a00f45085c1afb8448e6dff1d27af7be9ce43a68f33389d45451d717bd6fc801fe80e9eb1dfe002f685902135065889f882c80d319ff65550d4804abb7567d0b1986be197d22993ef03d5b19c018000000010b6dd0b4e57c8e073cbe94faf0b31bf125cda0e167d956895cdd19ced3cb2f011bad17b4ed1497b54b8f95314dd6675a4a79ba5514a00191034024fd8d59e2dc3992d182ba4caa1f77b7fa28b2f44c521347344bd661aa7f98ab2c50667a7483bebe4927f43e508e9c129c036344b6580f86d39d4180b07e23eba6455d1402151e8ff72c9a81ae94cf64ea2fc6325373d95ce02b4d67d302ca32a62c54842bdf1fb4a85fb657a3547ddbd5c6a6ca2c4b1f359cfdcdc07cb47aba955cfce9a90c5c46dcb6f2fcf14d8e80c55c0e4292e4fe83cb2d130c0e95de716c664f4b2e0d0a1dd11aeb1c92a9fecdaf51732610d6abf84e2e7372d9bd58bf70e96c72a2ab708fcc01767ec55a55ae65cd0fdef3ad36f3144970e490399b42b0802fdb2e7ce0bb100586f753795b04ef38c1e591b8699bd6dfb9b13c635c45f1a343ae08a9d710ed29c56185ff059154c7b93e601eef316b1f0eaf651099f34fd966d5478ff2868e679f58d2dabbde65a62f05036a62c5be22f58172a3e970710e862bc8e452a915862ec623eec82595001cb1b1e8628a5c178285d0f7239805398fb51b6950cd98e6135dac528fca1145343b1cb083906012eebb7063538f7259ad8e0347290991ae734be1800db6f4b6229b573a44c8fd71626823b52bf84689dbef8c1aed213af7ffef7c2c47b88b8193d804d4811760b8095eb5d11e1ec20ba1a91d06c3e9765d37918ec4a566b465ed18f7f25ce9cb81ebf571a52c09386f511a2ea9718460c28ddb5d8613afeebab64bdc69246ec2d2dc2095752a9a0fb0b1acaead14bc1f431fc6a19c2dd972e1b7e476a7c7b3163900d1ab1abf047bb6968ed9084b25b3448fe24207586b6779df758e2039297a2a04b0586fc0ef24893b925585a440f0196b53205da1078ad4ce5a4dfde61bcc72b0b36be3b41b49e64c32265782ae348e9dd87d0fa9c892443c9c7879d2292dc977d804953b341cd2481f80108e4789c6c8a7ce3b94e27ca10314872dbdc95089dcca74910059e40bab62222201007f45e50abf99d412b1df8e2271329ce203a19d83170565f1f42c00ee29c213a87000086c617a7964616e6534000001036e73310668746f6f6c730000d7f90d02208967ab9cc57d7aeab5ab691b657558c5185cee9e58ba6e091c4a3bf325ecaecd748601008cf70200c5002ce21784a8d6b375731f1784b06426670cdb54331ce19b21ce3d2ce348e9c7d30ffe90230b0001"

var sane_sane = "02b7962c4d8d015f20f891b7669dbae1edc4ef8f97086f1bf24cd76d7f38a6fca219c0190000000000ce64d3c071c69b741b523ee03098134fc3642b53ddca25374190343fcd9a5ed20663d982766166d88ce1447282533127c699eab28b35351f9b4edd6ed2f924d26540f62d0c960e86a1dc843b20fe5386813483d95a8853f2d5c8e4a001fe1fe82137a91946287653a2e4d89c601ef6f2992b975e784250f54ae8a1787442a13567fe5644cb49d6f2546342a308ab0d23fdbd08db2cf83d23b515c306bb812ab210779ded11c44c4845e666e05253c5371688ab175a3a9473a0a0401d6ccabf09cc7b0d457b6cf1f67745f3c45443868e22347d3f4b22846341a67be48552ed330443340dc8dd9f2bde5dc7b63d09cfe00620b4915391345b106f43644cb360192d6ca10c422e1a05a113e6e3f5d37dc76022929c65be58bcb362730e1a10433ef18da24fde090439cb74b7bae63f55eed1bfa01b41bb93475491bddbb84e0f4ee68dbbf58a77c24fa8c69fe79c6b2fa56dd89d82cc19bdbad61d55fef1b16d607bbef30e386f66f6e6463b5790abdec2ae62223a92fb6502fdaedd32a6f5dd52b4ef6fc6ae111d24f4451b7736cad2f953b2a6c5f47ae2067b169d10ce8086621f36cb6beacb41ff80cb1742b14f7a713b7b7e98a50edd13d507d09be3176265c1436b3c991c268ccb6d44343588262a9d253696b1f094e89653633dcdee9c0eb6ef857815e01d9060d21420cfaf7c3ea10cb6b78113917c956b5ebc2845122cd6cbf5f18b71683dfcc517995f544e6f68d26bda32c67130ba4eb486be60a1f58e3067f0e66296d628f2d03220510901f59c912920490a0e5358444303b8546d86129ebaf6d0b27877f2072fe17c50412c459bd58ae28bf4dc64dd0ca52e662af265559d84572a1975ce73cd40d85ee93ca37d9bb8a1a9fef3907919766879a8c2914f94cd71a26794110ad994605d4134ae91c02f9ff50edb8316f43f87f73a7ba4570241431307a3428386978bcc2f41a60d0a88245cf4e524d4d9ebf85d4e75c9d6b08ea37cb3f44778d54f074fffba694de176a0c41d2540d4e049c6499f11444b4abfab5d4bc217afd35ff623ab49d3fffd857b08367eb6dd7e4a8aa5635c16b31103afd193ea1a57b279df99cd0db16e57a0bb94eea236f393f41d2d1150000473616e6513000002036e73310473616e65002ce706b701c002b548000064210300c70052a00f45085c1afb8448e6dff1d27af7be9ce43a68f33389d45451d717bd6fc801fe80e9eb1dfe002f6859026d50435da7d1fcd726cace03c3aec60d14aa76ecee0ccc3a9e40ddb682d8c67619c019000000000010e025f273d0dc92d83ffc2442c845cadbbffdc55bb2b6e21460c396f4841fd76503090ce60d4d04ffc625173724dac819d8dba70d312cbf1e22941c90e2225172948af9df7ab41339817a6370c4852b6d5d5a7769377ff0c6cba46642d4a131fc633165da7d920388dbd1191e352728aeacece44deb808df10bd69328aa2497b944e8cb1fadaf42742ddbbc86a4dc0f7ad8fab5f5b2e4abc937c3fb551472dd89d7c05fb5e929d7edff5dcf730985434db64d313457d09f756f2856f6a6f0151b77bfec14c7ae6177125f744f5de9c721c2b912df2c7de8ef8eb90ab36396b39bf4f0fb9d4102aee95ec87a343dcc9c749b785cf95e1db3c3fab9a0ac2f19f6c8475dfeb9348e407c61d64c0f1763e20520fdcf13a4a3caff6cc8ea6d3d8972a8d0ee5f03965f8276e968594dbb4613c8e3fd2c973b971ce4a4fc7e0f3af37a18858cb00f5abbb471c6181c32526f316f4220fced323ce49575e068f320061a5baaf0affcddcb9f7cc7a04b933b9d635c5eb5787f07bcc39adb66157948545a9e2629363ae908092388dab13ebd52676868288efc2fbb2e07bf235d0f1b3c434c6a407de81eeb75f9af1f5cfd49d4e310a9697bc3293f40a76f85cb79735a3871c4447045ed0f86446146874f0a80f77912ed507060cd2c2f10b3c990e021ebb6ef857815e01d9060d21420cfaf7c3ea10cb6b78113917c956b5ebc2845122cd6cbf5f18b71683dfcc517995f544e6f68d26bda32c67130ba4eb486be60a1f57693d19560592d292ec3d1c4a4d311e3c985a3204c50434672c10fe550760eac86129ebaf6d0b27877f2072fe17c50412c459bd58ae28bf4dc64dd0ca52e662af265559d84572a1975ce73cd40d85ee93ca37d9bb8a1a9fef3907919766879a8c2914f94cd71a26794110ad994605d4134ae91c02f9ff50edb8316f43f87f73a7ba4570241431307a3428386978bcc2f41a60d0a88245cf4e524d4d9ebf85d4e75c9d6b08ea37cb3f44778d54f074fffba694de176a0c41d2540d4e049c6499f11444b4abfab5d4bc217afd35ff623ab49d3fffd857b08367eb6dd7e4a8aa5635c16b31103afd193ea1a57b279df99cd0db16e57a0bb94eea236f393f41d2d1150000473616e6513000002036e73310473616e65002ce706b701c002b548000064210300c70052a00f45085c1afb8448e6dff1d27af7be9ce43a68f33389d45451d717bd6fc801fe80e9eb1dfe002f685902"

// func TestZ(t *testing.T) {
// 	peng, _ := hex.DecodeString(paranoidPnaguionBoth)
// 	proof_count := uint8(peng[0])
// 	peng = peng[1:]
// 	log.Print("number of proofs is ", proof_count)
// 	var i uint8
// 	for i = 0; i < proof_count; i++ {
// 		peng = peng[32:]
// 		u, err := proof.NewFromBytes(peng)
// 		if err != nil {
// 			log.Fatal("from bytes err ", err)
// 		}
// 		var buf bytes.Buffer
// 		err = u.Serialize(&buf)
// 		if err != nil {
// 			log.Fatal("serialize err ", err)
// 		}
// 		log.Print("yopyoyo len buf ", len(buf.Bytes()))
// 		if i == 1 {
// 			break
// 		}
// 		// _, err := proof.NewFromBytes(peng[32+32+len(buf.Bytes()):])
// 		for j := 0; j < 100; j++ {
// 			// peng = peng[j+len(buf.Bytes()):]
// 			// log.Print("with j ", j, peng[j+len(buf.Bytes()):])
// 			_, err := proof.NewFromBytes(peng[j+len(buf.Bytes()):])
// 			if err != nil {
// 				log.Print("j = ", j)
// 				continue
// 			}
// 			log.Print("with j ", j, peng[j+len(buf.Bytes()):])
// 			log.Print("j aaaaa= ", j)
// 			// log.Print(peng)
// 			break
//
// 		}
// 		peng = peng[len(buf.Bytes()):]
// 		log.Print("final", peng)
// 		// log.Print("new ", peng[32:])
//
// 	}
// }

func Test3(t *testing.T) {
	// peng, _ := hex.DecodeString(paranoidPnaguionBoth)
	peng, _ := hex.DecodeString(sane_sane)
	// domain := "paranoidpenguin"
	domain := "sane"
	roots, err := sync.ReadStoredRoots("/home/shevtsov/.sane/roots.json")
	if err != nil {
		log.Fatal("read err", err)
	}
	UrkelVerificationError := verifyUrkelExt(peng, domain, roots)
	log.Print("errrrrrr ", UrkelVerificationError)
	// verifyUrkelExt(peng, roots, domain)

}

// func TestYoyo(t *testing.T) {
// 	// domain := "test.lazydane."
// 	// domain := "paranoidpenguin"
// 	// roots, err := sync.ReadStoredRoots("/home/shevtsov/.sane/roots.json")
// 	// if err != nil {
// 	// 	log.Fatal("read err", err)
// 	// }
// 	// urkel, err := fetchUrkel(domain, defaultURL)
// 	// if err != nil {
// 	// 	log.Fatal("fetch err", err)
// 	// 	// return err
// 	// }
// 	// log.Print(urkel)
// 	// log.Print("got urkel from external")
// 	// labels := dns.SplitDomainName(domain)
// 	// tld := labels[len(labels)-1]
// 	// log.Print(urkel[len(urkel)-1])
// 	// urkel[100] = 14
// 	// urkel[len(urkel)-1] = 14
// 	// log.Print(urkel[len(urkel)-1])
// 	//
// 	// u, err := proof.NewFromJSON(str)
// 	// if err != nil {
// 	// 	log.Fatal("json err ", err)
// 	// }
// 	// log.Print("depth ", u.Depth)
// 	// u, err = proof.NewFromJSON(str2)
// 	// if err != nil {
// 	// 	log.Fatal("json err ", err)
// 	// }
// 	// log.Print("depth ", u.Depth)
// 	//
// 	// lll, _ := hex.DecodeString(lazydane_raw)
// 	// u, err = proof.NewFromBytes(lll[33:])
// 	// // u, err = proof.NewFromJSON(lazydane)
// 	// if err != nil {
// 	// 	log.Fatal("json err ", err)
// 	// }
// 	// log.Print(u)
// 	// log.Print("lazydane depth ", u.Depth)
// 	// log.Print("lazydane value ", hex.EncodeToString(u.Value()))
// 	// log.Print("lazydane prefix size ", u.Prefix.Size())
// 	//
// 	// // log.Print("lazydane value ", u.Prefix.Size())
// 	//
// 	// shh, _ := hex.DecodeString(rawstr)
// 	// u, err = proof.NewFromBytes(shh[33:])
// 	// if err != nil {
// 	// 	log.Fatal("json err ", err)
// 	// }
// 	// log.Print("depth ", u.Depth)
//
// 	// u, err = proof.NewFromBytes([]byte(rawstr[33:]))
// 	// qq, _ := hex.DecodeString(rawstr)
// 	// u, err = proof.NewFromBytes(qq[33:])
// 	// if err != nil {
// 	// 	log.Fatal("json err ", err)
// 	// }
// 	// log.Print("depth ", u.Depth)
//
// 	// u, err = proof.NewFromBytes([]byte(rawstr[33:]))
// 	peng, _ := hex.DecodeString(paranoidPnaguionBoth)
// 	log.Print("number of proofs is ", peng[0])
// 	u, err := proof.NewFromBytes(peng[33:])
// 	if err != nil {
// 		log.Fatal("json err ", err)
// 	}
// 	log.Print("peng depth ", u.Depth)
// 	log.Print("peng itself ", hex.EncodeToString(u.Value()))
//
// 	pengsec, _ := hex.DecodeString(peng2)
// 	for i := 0; i < len(pengsec)-1; i++ {
// 		uuu, err := proof.NewFromBytes(pengsec[i:])
// 		if err != nil {
// 			continue
// 			// log.Fatal("not json err ", err)
// 		}
// 		log.Print("theindex ", i)
// 		log.Print("peng2 depth ", uuu.Depth)
// 		// log.Print("lazydane depth ", len(uuu.Prefix))
// 		// log.Print("peng2 hex ", hex.EncodeToString(pengsec))
// 		log.Print("len peng2 ", len(pengsec))
// 		// log.Print("len peng2 value", uuu.Value())
// 		log.Print("sums prefix: ", i, " + 32*depth=", 32*uuu.Depth, " uuu value :", len(uuu.Value()))
// 		break
// 		// log.Print("peng2 itself ", hex.EncodeToString(uuu.Value()))
// 	}
//
// 	pengfirst, _ := hex.DecodeString(lazydane_raw)
// 	log.Print("number of proofs is ", pengfirst[0])
// 	for i := 0; i < len(pengfirst)-1; i++ {
// 		uuu, err := proof.NewFromBytes(pengfirst[i:])
// 		if err != nil {
// 			continue
// 			// log.Fatal("not json err ", err)
// 		}
// 		log.Print("lazydane index ", i)
// 		log.Print("lazydane depth ", uuu.Depth)
// 		log.Print("lazydane depth ", uuu.Prefix)
// 		log.Print("uuu ", uuu)
// 		// log.Print("peng2 hex ", hex.EncodeToString(pengfirst))
// 		// log.Print("len lazydane ", len(pengfirst))
// 		log.Print("len lazydane ", len(pengfirst[i:]))
// 		log.Print("wwwlazydane prefix length ", uuu.Prefix.SerializeSize())
// 		log.Print("wwwlazydane prefix length ", uuu.Prefix.String())
// 		// log.Print("len lazydane value", uuu.Value())
// 		log.Print("sums prefix: ", i, " + 32*depth=", 32*uuu.Depth, " uuu value :", len(uuu.Value()))
// 		zz, _ := uuu.MarshalJSON()
// 		log.Print("in json ", string(zz))
// 		break
// 		// log.Print("peng2 itself ", hex.EncodeToString(uuu.Value()))
// 	}
//
// 	sanee, _ := hex.DecodeString(sane)
// 	log.Print("number of proofs is ", sanee[0])
// 	for i := 0; i < len(sanee)-1; i++ {
// 		uuu, err := proof.NewFromBytes(sanee[i:])
// 		if err != nil {
// 			continue
// 			// log.Fatal("not json err ", err)
// 		}
// 		log.Print("sane index ", i)
// 		log.Print("sane depth ", uuu.Depth)
// 		log.Print("sane prefi ", uuu.Prefix)
// 		log.Print("wwwsane prefix length ", uuu.Prefix.SerializeSize())
// 		log.Print("wwwsane prefix length ", uuu.Prefix.String())
//
// 		log.Print("uuu ", uuu)
// 		// log.Print("peng2 hex ", hex.EncodeToString(sanee))
// 		// log.Print("len sane ", len(sanee))
// 		log.Print("len sane ", len(sanee[i:]))
// 		// log.Print("len sane value", uuu.Value())
// 		log.Print("sums prefix: ", i, " + 32*depth=", 32*uuu.Depth, " uuu value :", len(uuu.Value()))
// 		zz, _ := uuu.MarshalJSON()
// 		log.Print("in json ", string(zz))
// 		var buf bytes.Buffer
// 		err = uuu.Serialize(&buf)
// 		log.Print("yopyoyo len buf ", len(buf.Bytes()))
// 		log.Print("yopyoyo buf ", buf)
// 		// if err != nil {
// 		// return nil, err
// 		break
// 		// log.Print("peng2 itself ", hex.EncodeToString(uuu.Value()))
// 	}
//
// 	// urkel
// 	// UrkelVerificationError := verifyUrkelExt(urkel, tld, roots)
// 	// // UrkelVerificationError := verifyUrkelExtC(urkel, tld, roots)
// 	// if UrkelVerificationError != nil {
// 	// 	log.Print("UrkelVerificationError:", UrkelVerificationError)
// 	// 	// return UrkelVerificationError
// 	// }
//
// }

// func TestDNSSEC(*testing.T) {
// 	domain := "lazydane"
// 	zzz, _ := hex.DecodeString(mystr)
// 	records, err := dnssec.ParseExt(zzz)
// 	if err != nil {
// 		log.Print(err)
// 	}
// 	var tlsa *dns.TLSA
// 	for _, record := range records {
// 		log.Println(record)
// 	}
// 	for _, record := range records {
// 		r, fa := record.(*dns.TLSA)
// 		if !fa {
// 			// log.Print(err)
// 			continue
// 		}
// 		tlsa = r
// 		break
// 	}
// 	// log.Print(tlsa)
// 	DNSSECVerificationError := dnssec.VerifyDNSSECChain(records, domain, tlsa)
// 	if DNSSECVerificationError != nil {
// 		log.Print("DNSSECVerificationError ", DNSSECVerificationError, " ", domain)
// 		// return DNSSECVerificationError
// 	}
//
// }

// func TestVerifyCertificateExtensions(t *testing.T) {
// 	roots, err := sync.ReadStoredRoots("/home/shevtsov/.sane/roots.json")
// 	if err != nil {
// 		log.Fatal(err)
// 	}
//
// 	certFile, err := os.ReadFile("../test_certs/0F.pem")
// 	if err != nil {
// 		log.Fatal(err)
// 	}
//
// 	block, _ := pem.Decode(certFile)
// 	if block == nil {
// 		log.Fatal(err)
// 	}
// 	cert, err := x509.ParseCertificate(block.Bytes)
// 	if err != nil {
// 		fmt.Println("Error parsing public key:", err)
// 		return
// 	}
//
// 	log.Print(cert.DNSNames)
// 	a := cert.DNSNames[0]
// 	y, z := dns.IsDomainName(a)
// 	log.Print(y, z)
// 	x := dns.SplitDomainName(a)
// 	log.Print(x)
// 	// log.Print(len(cert.DNSNames))
//
// 	err = VerifyCertificateExtensions(roots, *cert, nil, "")
// 	if err != nil {
// 		log.Fatal(err)
// 	}

// }
